import { createI18n } from "vue-i18n";

export const SUPPORTED_LOCALES = ["en", "zh"] as const;
export type Locale = (typeof SUPPORTED_LOCALES)[number];

const messages = {
  en: {
    language: {
      en: "English",
      zh: "Chinese",
    },
    common: {
      noData: "No data",
      invalidJson: "Invalid JSON",
      auto: "Auto",
    },
    app: {
      settings: "Settings",
      language: "Language",
      switchLanguage: "Switch language to {lang}",
      controlConsole: "Control console",
      toggleConsole: "Toggle console",
      consoleMetaEmpty: "Select a device to enable controls.",
      sessionDetailsEmpty: "Select a device to view session details.",
      tabs: {
        control: "Control",
        session: "Session",
        log: "Log",
      },
    },
    log: {
      title: "Run log",
      action: {
        live: "Live log",
        pause: "Pause log",
        copy: "Copy log",
      },
      meta: {
        showing: "Showing last {lines} of {total} lines",
        lines: "{lines} lines",
      },
      noLog: "No log loaded.",
      noRun: "No run selected.",
      unavailable: "Log unavailable.",
      status: {
        live: "Live",
        paused: "Paused",
        connecting: "Connecting",
        reconnecting: "Reconnecting",
        reconnectingIn: "Reconnecting in {seconds}s",
        error: "Error",
      },
    },
    form: {
      goal: "Goal",
      goalPlaceholder: "Describe the task",
      execute: "Execute",
      plan: "Plan",
      advanced: "Advanced",
      maxSteps: "Max steps",
      planSteps: "Plan steps",
      planVerify: "Plan verify",
      planVerifyOptions: {
        llm: "LLM",
        none: "None",
      },
      device: "Device",
      auto: "Auto",
      skills: "Skills",
      textOnly: "Text only",
      planResume: "Plan resume",
      run: "Run",
      stop: "Stop",
    },
    timeline: {
      title: "Conversation",
      showRuns: "Show runs",
      hideRuns: "Hide runs",
      searchRuns: "Search runs",
      selectRun: "Select a run",
      selectRunHint: "Select a run to view the session.",
      goal: "Goal",
      noGoal: "No goal provided.",
      noSteps: "No steps yet.",
      step: "Step {index}",
      tryLabel: "try {attempt}",
      you: "You",
      evidence: "Evidence",
      evidenceSelect: "Select a step to view screenshots.",
      evidenceNone: "No screenshots available.",
      before: "Before",
      after: "After",
      noBefore: "No before image.",
      noAfter: "No after image.",
      decision: "Decision",
      prompt: "Prompt",
      response: "Response",
      context: "Context",
      verification: "Verification",
    },
    live: {
      title: "Live devices",
      noDevices: "No devices detected.",
      session: "Session",
      queue: "Queue",
      stream: "Stream",
      control: "Control",
      status: "Status",
      stats: "Stats",
      streamStopped: "Stream stopped",
      mjpegStream: "MJPEG stream",
      connecting: "Connecting...",
      unavailable: "Unavailable",
      start: "Start",
      stop: "Stop",
      controlOn: "Control on",
      controlOff: "Control off",
      audioOn: "Audio on",
      audioOff: "Audio off",
      audioUnavailable: "Audio unavailable",
      densityCompact: "Compact density",
      densityComfort: "Comfort density",
      refresh: "Refresh devices",
      switchToMjpeg: "Switch to MJPEG",
      switchToWebrtc: "Switch to WebRTC",
      hideOverlay: "Hide overlay",
      showOverlay: "Show overlay",
      statsFpsEmpty: "— fps",
      connectionConnected: "Connected",
      connectionConnecting: "Connecting",
      connectionOffline: "Offline",
      clientOffline: "Client offline",
    },
    stream: {
      off: "Off",
      mjpeg: "MJPEG",
      webrtc: "WebRTC",
    },
    streamSession: {
      video: "Video",
      audio: "Audio",
      control: "Control",
      start: "Start session",
      stop: "Stop session",
      restart: "Restart session",
      status: {
        starting: "Starting",
        running: "Running",
        stopping: "Stopping",
        stopped: "Stopped",
        error: "Error",
      },
    },
    device: {
      title: "Device control",
      label: "Device",
      select: "Select device",
      back: "Back",
      home: "Home",
      recents: "Recents",
      power: "Power",
      volumeUp: "Volume up",
      volumeDown: "Volume down",
      inputPlaceholder: "Type to send to focused field",
      inputSend: "Send text",
    },
    status: {
      running: "Running",
      finished: "Finished",
      failed: "Failed",
      stopping: "Stopping",
      stopped: "Stopped",
      idle: "Idle",
      done: "Done",
      pending: "Pending",
      device: "Online",
      offline: "Offline",
      unauthorized: "Unauthorized",
      unknown: "Unknown",
      none: "None",
      on: "On",
      off: "Off",
    },
    session: {
      selectDevice: "Select a device to send commands.",
      none: "No session yet.",
      error: "Error: {message}",
      runningQueue: "Running · queue {pending}",
      queuedPending: "Queued · {pending} pending",
      idle: "Idle",
      offline: "Client offline",
    },
    sessionDetails: {
      device: "Device",
      deviceId: "Device ID",
      session: "Session",
      sessionStatus: "Status",
      pending: "Pending",
      currentCommand: "Current command",
      lastError: "Last error",
      createdAt: "Created",
      updatedAt: "Updated",
      stream: "Stream",
      mode: "Mode",
      streamStatus: "Stream status",
      resolution: "Resolution",
      stats: "Stats",
      fps: "FPS",
      bitrate: "Bitrate",
      packets: "Packets",
      frames: "Frames",
      jitter: "Jitter",
      lastUpdate: "Last update",
      updatedNow: "Updated just now",
      updatedSeconds: "Updated {seconds}s ago",
      updatedMinutes: "Updated {minutes}m ago",
      updatedHours: "Updated {hours}h ago",
    },
    list: {
      runs: "Runs",
      steps: "Steps",
      refresh: "Refresh",
      noRuns: "No runs yet.",
      noSteps: "No steps yet.",
      run: "Run",
      step: "Step",
      noDecision: "No decision",
      screen: "screen",
      actions: "{count} actions",
    },
    decisionTabs: {
      decision: "Decision",
      prompt: "Prompt",
      response: "Response",
      context: "Context",
    },
    screen: {
      title: "Screen",
      before: "Before",
      after: "After",
      loading: "Loading screenshot...",
      noImage: "No screenshot available",
      noScreen: "No screenshot loaded",
    },
    inspector: {
      runDetails: "Run details",
      verification: "Verification",
      runLog: "Run log",
      pause: "Pause",
      live: "Live",
      refresh: "Refresh",
      all: "All",
      error: "Error",
      warn: "Warn",
      info: "Info",
      searchLogs: "Search logs",
      prev: "Prev",
      next: "Next",
      copy: "Copy",
      download: "Download",
      follow: "Follow",
    },
    topbar: {
      title: "MRPA Studio",
      subtitle: "Agent control and run explorer",
    },
    brand: {
      title: "MRPA Studio",
      subtitle: "Agent control and run explorer",
      expand: "Expand panel",
      collapse: "Collapse panel",
    },
  },
  zh: {
    language: {
      en: "English",
      zh: "中文",
    },
    common: {
      noData: "暂无数据",
      invalidJson: "JSON 无效",
      auto: "自动",
    },
    app: {
      settings: "设置",
      language: "语言",
      switchLanguage: "切换语言为{lang}",
      controlConsole: "控制台",
      toggleConsole: "展开/收起控制台",
      consoleMetaEmpty: "选择设备以启用控制。",
      sessionDetailsEmpty: "选择设备查看会话详情。",
      tabs: {
        control: "控制",
        session: "会话",
        log: "日志",
      },
    },
    log: {
      title: "运行日志",
      action: {
        live: "实时日志",
        pause: "暂停日志",
        copy: "复制日志",
      },
      meta: {
        showing: "显示最近 {lines}/{total} 行",
        lines: "{lines} 行",
      },
      noLog: "暂无日志。",
      noRun: "未选择会话。",
      unavailable: "日志不可用。",
      status: {
        live: "实时",
        paused: "暂停",
        connecting: "连接中",
        reconnecting: "重连中",
        reconnectingIn: "{seconds}s 后重连",
        error: "错误",
      },
    },
    form: {
      goal: "目标",
      goalPlaceholder: "描述任务",
      execute: "执行",
      plan: "规划",
      advanced: "高级",
      maxSteps: "最大步数",
      planSteps: "规划步数",
      planVerify: "规划验证",
      planVerifyOptions: {
        llm: "LLM",
        none: "无",
      },
      device: "设备",
      auto: "自动",
      skills: "技能",
      textOnly: "纯文本",
      planResume: "续跑规划",
      run: "运行",
      stop: "停止",
    },
    timeline: {
      title: "会话",
      showRuns: "显示会话",
      hideRuns: "隐藏会话",
      searchRuns: "搜索会话",
      selectRun: "选择会话",
      selectRunHint: "选择会话查看详情。",
      goal: "目标",
      noGoal: "未提供目标。",
      noSteps: "暂无步骤。",
      step: "步骤 {index}",
      tryLabel: "尝试 {attempt}",
      you: "你",
      evidence: "证据",
      evidenceSelect: "选择步骤查看截图。",
      evidenceNone: "暂无截图。",
      before: "之前",
      after: "之后",
      noBefore: "无之前截图。",
      noAfter: "无之后截图。",
      decision: "决策",
      prompt: "提示",
      response: "响应",
      context: "上下文",
      verification: "验证",
    },
    live: {
      title: "实时设备",
      noDevices: "未检测到设备。",
      session: "会话",
      queue: "队列",
      stream: "流",
      control: "控制",
      status: "状态",
      stats: "统计",
      streamStopped: "流已停止",
      mjpegStream: "MJPEG 流",
      connecting: "连接中...",
      unavailable: "不可用",
      start: "开始",
      stop: "停止",
      controlOn: "控制开",
      controlOff: "控制关",
      audioOn: "声音开",
      audioOff: "声音关",
      audioUnavailable: "声音不可用",
      densityCompact: "紧凑密度",
      densityComfort: "舒适密度",
      refresh: "刷新设备",
      switchToMjpeg: "切换到 MJPEG",
      switchToWebrtc: "切换到 WebRTC",
      hideOverlay: "隐藏标识",
      showOverlay: "显示标识",
      statsFpsEmpty: "— fps",
      connectionConnected: "已连接",
      connectionConnecting: "连接中",
      connectionOffline: "未连接",
      clientOffline: "\u5ba2\u6237\u7aef\u79bb\u7ebf",
    },
    stream: {
      off: "关闭",
      mjpeg: "MJPEG",
      webrtc: "WebRTC",
    },
    streamSession: {
      video: "视频",
      audio: "音频",
      control: "控制",
      start: "启动",
      stop: "停止",
      restart: "重启",
      status: {
        running: "运行中",
        stopped: "已停止",
        error: "错误",
      },
    },
    device: {
      title: "设备控制",
      label: "设备",
      select: "选择设备",
      back: "返回",
      home: "主页",
      recents: "最近",
      power: "电源",
      volumeUp: "音量+",
      volumeDown: "音量-",
      inputPlaceholder: "输入并发送到焦点输入框",
      inputSend: "发送文本",
    },
    status: {
      running: "运行中",
      finished: "已完成",
      failed: "失败",
      stopping: "停止中",
      stopped: "已停止",
      idle: "空闲",
      done: "完成",
      pending: "待定",
      device: "在线",
      offline: "离线",
      unauthorized: "未授权",
      unknown: "未知",
      none: "无",
      on: "开",
      off: "关",
    },
    session: {
      selectDevice: "选择设备发送指令。",
      none: "暂无会话。",
      error: "错误：{message}",
      runningQueue: "运行中 · 队列 {pending}",
      queuedPending: "排队中 · {pending} 待处理",
      idle: "空闲",
      offline: "\u5ba2\u6237\u7aef\u79bb\u7ebf",
    },
    sessionDetails: {
      device: "设备",
      deviceId: "设备 ID",
      session: "会话",
      sessionStatus: "状态",
      pending: "待处理",
      currentCommand: "当前命令",
      lastError: "最近错误",
      createdAt: "创建时间",
      updatedAt: "更新时间",
      stream: "流",
      mode: "模式",
      streamStatus: "流状态",
      resolution: "分辨率",
      stats: "统计",
      fps: "FPS",
      bitrate: "码率",
      packets: "包数",
      frames: "帧数",
      jitter: "抖动",
      lastUpdate: "统计时间",
      updatedNow: "刚刚更新",
      updatedSeconds: "{seconds} 秒前更新",
      updatedMinutes: "{minutes} 分钟前更新",
      updatedHours: "{hours} 小时前更新",
    },

    list: {
      runs: "运行",
      steps: "步骤",
      refresh: "刷新",
      noRuns: "暂无运行。",
      noSteps: "暂无步骤。",
      run: "运行",
      step: "步骤",
      noDecision: "无决策",
      screen: "屏幕",
      actions: "{count} 个动作",
    },
    decisionTabs: {
      decision: "决策",
      prompt: "提示",
      response: "响应",
      context: "上下文",
    },
    screen: {
      title: "屏幕",
      before: "之前",
      after: "之后",
      loading: "加载截图中...",
      noImage: "暂无截图",
      noScreen: "未加载截图",
    },
    inspector: {
      runDetails: "运行详情",
      verification: "验证",
      runLog: "运行日志",
      pause: "暂停",
      live: "实时",
      refresh: "刷新",
      all: "全部",
      error: "错误",
      warn: "警告",
      info: "信息",
      searchLogs: "搜索日志",
      prev: "上一条",
      next: "下一条",
      copy: "复制",
      download: "下载",
      follow: "跟随",
    },
    topbar: {
      title: "MRPA Studio",
      subtitle: "代理控制与运行探索",
    },
    brand: {
      title: "MRPA Studio",
      subtitle: "代理控制与运行探索",
      expand: "展开面板",
      collapse: "收起面板",
    },
  },
} as const;

const storageKey = "mrpa.locale";

function detectLocale(): Locale {
  if (typeof window === "undefined") {
    return "en";
  }
  const saved = window.localStorage.getItem(storageKey) as Locale | null;
  if (saved && SUPPORTED_LOCALES.includes(saved)) {
    return saved;
  }
  const browser = window.navigator.language.toLowerCase();
  return browser.startsWith("zh") ? "zh" : "en";
}

export const i18n = createI18n({
  legacy: false,
  globalInjection: true,
  locale: detectLocale(),
  fallbackLocale: "en",
  messages,
});

export function setLocale(locale: Locale) {
  i18n.global.locale.value = locale;
  if (typeof window !== "undefined") {
    window.localStorage.setItem(storageKey, locale);
  }
  if (typeof document !== "undefined") {
    document.documentElement.setAttribute("lang", locale);
  }
}
